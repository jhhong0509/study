# AWS 서버 환경 만들기

### 클라우드 서비스

- 24시간 작동하는 서버
  - 24시간 집 PC 구동
    - 저렴함
  - 호스팅 서비스 이용
    - 저렴함
  - 클라우드 서비스 이용
    - 유동적으로 사양을 늘릴 수 있음

- 클라우드 서비스의 종류

  - Infrastructure as a Service(IaaS)
    - 물리장비를 미들웨어와 묶어둔 추상화 서비스 이다.
    - 가상머신, 스토리지, 운영체제 등 IT 인프라를 대여해 주는 서비스
    - 대표적으로 EC2가 있다.
  - Platform as a Service(PaaS)
    - IaaS를 한번 더 추상화한 서비스
    - 자동화된 기능이 많다
    - 대표적으로 헤로쿠가 있다.
  - Software as a Service(Saas)
    - 소프트웨어 서비스
    - 대표적으로 구글 드라이브가 있다.

- AWS를 선택하는 이유

  - 단순히 서버 장비를 대여하는 것이 아니다.
  - 로그 관리, 하드웨어 교체, 네트워크 관리 등 기본적인 모든 것을 지원한다.
  - 1년간 대부분 무료이다.
  - 소규모일때 개발에 집중할 수 있다.
  - 클라우드를 사용하는 대부분의 기업들이 AWS를 이용한다.
  - AWS 사용 경험은 취직/이직 때 많은 도움이 된다.

  - 커뮤니티가 활성화 되어 있다.

- IaaS를 이용하는 이유
  - PaaS인 빈스톡을 이용할 수 있지만, 프리티어(무료)로 무중단 배포를 할 수 없다.
  - 그렇기 때문에 IaaS를 이용한다.

### EC2 인스턴스 생성하기

- 프리티어 제한
  - 사양 제한이 t2.micro이다.
    - vCPU 1코어, 메모리 1GB
    - vCPU는 그냥 CPU의 절반 정도의 성능
  - 월 750시간 제한(초과시 요금 발생)
    - 한달은 744시간 이기 때문에 만약 EC2가 하나라면 1달 내내 구동할 수 있다.

- 리전 확인
  - 실제 서비스될 지역과 가까울수록 빠르다.
  - 국내에서 서비스할 경우 서울로 골라야 한다.
- 생성하기
  - EC2 대시보드를 들어간다.
  - 인스턴스 시작을 누른다.
  - 아마존 리눅스 1 AMI를 선택한다.
    - AMI란 필요한 정보를 이미지로 만들어 둔 것이다.
    - 가상머신에 운영체제를 설치하도록 구운 이미지이다.
    - 아마존 리눅스 1 AMI를 이용하는 이유는 아직 국내 자료가 1이 더 많기 때문이다.
    - 센토스 AMI를 이용하지 않는 이유
      - 아마존이 개발하기 때문에 지원받기 쉽다.
      - AWS의 서비스와 상성이 좋다.
      - AWS의 독자적인 레포를 사용하기 때문에 yum이 매우 빠르다.
  - 인스턴스 유형은 t2.micro를 선택한다.
    - t2는 요금 타입이란 뜻이다.
    - t 시리즈는 크레딧 이라는 포인트를 이용한다.
      - CPU를 사용하지 않을 때 포인트가 쌓이고, CPU를 사용할 때 포인트를 사용한다.
      - 높은 트래픽이 오면 크레딧을 더 사용한다.
      - 크레딧을 모두 사용하면 EC2를 사용할 수 없다.
  - 세부 정보 구성은 연습할 때엔 굳이 필요 없으니 넘어간다.
    - 네트워크 환경 구성 등 세세한 정보를 다룬다.
    - 하지만 소규모/개인/공부 라면 굳이 설정할 필요 없다.
  - 스토리지 선택은 서버의 용량을 설정하는 단계이다.
    - 기본값이 8GB이지만, 프리티어 최대치는 30GB 이므로 30GB로 바꿔준다.
  - 태그는 웹 콘솔에 표시될 이름이다.
    - 인스턴스가 여러개 일때, 태그로 검색이나 그룹이 편하기 때문에, 원하는 만큼 등록하면 된다.
  - 보안 그룹은 방화벽을 이야기 한다.
    - 기본적으로는 80포트를 제외하고 허용하지 않는다.
    - 굉장히 중요하다. 만약 모두 열어버린다면 pem 파일(키)가 유출되는 순간, 모든 보안이 뚫리게 되므로, 자신의 아이피만 추가한다.
    - SSH에 22포트는 터미널로 접속하는 경우인데, 내 아이피로 설정하고, 만약 카페와 같은곳을 가게 되면 그곳의 아이피를 추가하는것이 좋다.
  - 다음을 눌렀을 때 보안 그룹 경고를 하는데, 8080포트를 여는것은 위험하지 않으니 시작하기를 누른다.
  - pem 파일을 저장할 수 있는데, 절대 유출하면 안된다.
    - 마스터키와 같은 역할이기 때문에, EC2 서버 접속에 필수적인 파일이다.
    - 잘 보관해야 한다.

### 기본적인 설정

- 인스턴스 또한 IP가 존재한다.
- 인스턴스 생성 또는 재시작 시에 새 IP가 할당된다.
- 즉, 인스턴스 재시작 후에는 접속해야 하는 IP가 변경된다.
- 그래서 고정 IP를 가지게 하면 편하다.
- 인스턴스 페이지에서 왼쪽의 탄력적 IP를 선택한다.
- 새 주소 할당 버튼을 누른다.
- 할당 버튼을 누른다.
- 해당 IP와 EC2 주소를 연결해 준다.
  - 생성한 탄력적 IP를 확인한다.
  - 위쪽의 작업 -> 주소연결을 선택한다.
  - EC2 이름과 UP를 입력하고 연결 버튼을 누른다.
- *만약 탄력적 IP를 생성하고 EC2에 연결하지 않으면 비용이 발생한다.*
  - 꼭 연결해 줘야 한다.

### EC2 접속하기

#### 맥/리눅스

- 터미널을 통해 접속한다.

- ssh -i pem 키위치 탄력적IP 를 치면 접속할 수 있다.

  - 귀찮으니까 ssh 접속을 할 수 있도록 하자

  - pem 파일을 /.ssh/로 복사한다.

  - 그리고 pem 키 권한을 바꿔준다.

    - chmod 600 ~/.ssh/키 이름

  - 그리고 config 파일을 생성해 준다.(확장자 X)

    - vim ~/.ssh/config

    - ```
      Host 서비스명
      	HostName 탄력적 IP
      	User ec2-user
      	IdentityFile ~/.ssh/키 이름
      ```

    - wq로 종료해 준다.

  - 또한 config 파일의 권한을 설정해 준다.

    - chmod 700 ~/.ssh/config

  - 그리고 이제, ssh 서비스명 만을 통해 접속할 수 있다.

#### Windows

- 별도의 클라이언트를 설치하는게 편하기 때문에 putty와 puttygen을 설치해 준다.
- puttygen으로 ppk 파일 생성
  - putty는 pem파일을 사용할 수 없고, ppk 파일만 이용할 수 있다.
  - puttygen에서 import key를 누른다.
  - pem 파일을 선택한다.
  - save private key를 누른다.
  - ppk 파일을 저장한다.
- putty를 통해 접속하기
  - 호스트에는 ec2-user@탄력적IP 를 쓴다.
  - 포트는 22
  - Connection Type은 SSH로 둔다
  - 키 설정
    - 왼쪽의 사이드바에서 Connection -> SSH -> Auth 탭을 선택한다.
    - Browse를 누른다.
    - ppk를 불러온다.
  - 다시 사이드바 맨 위쪽 Session을 선택한다.
  - Save Sessions에 이름을 적고, save를 누른다.
    - 그러면 해당 이름으로 추가되는데, 다음에는 이 이름을 더블클릭하면 접속할 수 있다.
  - Open을 누른다.

### 서버 설정하기

- 자바 설치
  - 기본적으로 자바 7이 깔려있기 때문에, 새로운 자바를 깔고, 지워야 한다.
  - sudo yum install -y java-1.8.0-openjdk-devel.x86_64 를 통해 자바 8을 설치할 수 있다.
  - 해당 인스턴스의 자바 버전을 번경하기 위해, sudo /usr/sbin/alternatives --config java 를 친 후에, Java8을 선택한다.
  - 그리고 sudo yum remove java-1.7.0-openjdk 를 통해 자바 7을 지워준다.
  - java -version을 통해 자바가 제대로 설치되었는지 확인한다.
- 시간 설정
  - EC2는 기본적으로 UTC(세계 표준 시간)을 이용하기 때문에 한국과 시간차이가 발생한다.
  - 그렇기에 수정해 줘야 한다.
  - sudo rm /etc/localtime
  - sudo ln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime
  - date 를 통해 시간이 정상적인지 확인할 수 있다.
- Hostname 변경
  - 서버의 IP만 가지고 어떤 서비스 서번지 알기 힘들기 때문에, 이름을 변경하도록 한다.
  - sudo vim /etc/sysconfig/network 를 통해 편집 파일을 연다.
  - 해당 부분중, HOSTNAME을 원하는 이름으로 바꿔준다.
  - 서버를 sudo reboot 를 통해 재부팅한다.
  - sudo vim /etc/hosts 를 통해 파일을 연다.
  - HOSTNAME을 등록한다
    - 127.0.0.1 HOSTNAME
  - :wq로 종료한다.
  - curl 호스트이름 을 통해 확인한다.
    - 잘 되었다면 80포트 접근이 불가능 하다는 에러가 발생한다.

